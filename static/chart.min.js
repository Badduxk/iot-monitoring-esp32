/*!
 Lightweight loader: chart.min.js
 This small loader will dynamically inject Chart.js v4 from CDN into the page.
 It exposes a global `Chart` when ready and queues calls to `onChartReady(fn)`.
*/

(function(window, document){
  var CDN = "https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js";
  var READY = false;
  var Q = [];

  function onLoad() {
    READY = true;
    // flush queue
    for (var i = 0; i < Q.length; i++) {
      try { Q[i](); } catch(e){ console.error(e); }
    }
    Q = [];
  }

  function injectScript(src, cb) {
    var s = document.createElement("script");
    s.src = src;
    s.async = true;
    s.onload = cb;
    s.onerror = function(e){
      console.error("Gagal memuat Chart.js dari CDN:", e);
    };
    document.head.appendChild(s);
  }

  // Public: queue callback when Chart is ready
  window.onChartReady = function(fn){
    if (typeof fn !== "function") return;
    if (READY && window.Chart) {
      try { fn(window.Chart); } catch(e){ console.error(e); }
    } else {
      Q.push(function(){ fn(window.Chart); });
    }
  };

  // If Chart already present (developer included real chart.js), mark ready
  if (window.Chart) {
    READY = true;
  } else {
    injectScript(CDN, onLoad);
  }

  // small helper to create a chart safely after Chart is loaded
  window.createChartSafe = function(canvasEl, cfg){
    window.onChartReady(function(ChartLib){
      var ctx = (typeof canvasEl === "string") ? document.getElementById(canvasEl).getContext('2d') :
                (canvasEl.getContext ? canvasEl.getContext('2d') : canvasEl);
      return new ChartLib(ctx, cfg);
    });
  };

  // ======================================================
  // ðŸ“Œ Tambahan: hitung suhu max, min, rata-rata
  // data = array angka [30, 29, 31, ...]
  // ======================================================
  window.calcStats = function(data){
    if (!Array.isArray(data) || data.length === 0) 
      return { max: 0, min: 0, avg: 0 };

    let max = Math.max(...data);
    let min = Math.min(...data);
    let avg = data.reduce((a,b)=>a+b,0) / data.length;

    return {
      max: max,
      min: min,
      avg: parseFloat(avg.toFixed(2))
    };
  };

})(window, document);
